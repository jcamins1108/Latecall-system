<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Manager Login & Dashboard</title>
<style>
/* General body and font */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f4f6f8;
    color: #333;
    min-height: 100vh;
}

/* Centered container for login page */
.container {
    max-width: 400px;
    margin: 80px auto 20px;
    padding: 30px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

/* Login inputs */
input[type="text"], input[type="password"] {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
}

/* Buttons style */
button {
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}
button:hover { opacity: 0.9; }
#loginBtn {
    width: 100%;
    background-color: #4CAF50;
    color: white;
}
#logoutBtn {
    background-color: #f44336;
    color: white;
    font-size: 14px;
    padding: 5px 10px;
}

/* Error message */
.error {
    color: red;
    text-align: center;
    margin-top: 10px;
}

/* Dashboard Header */
#dashboardPage .header {
    position: relative;
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px;
}
#dashboardPage .header .title {
    font-size: 28px;
    font-weight: bold;
    display: inline-block;
    position: relative;
    z-index: 1;
}
#dashboardPage .header img.logo-left {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 60px;
}
#dashboardPage .header img.logo-right {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 60px;
}

/* Top bar with name + logout and filter + export */
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 15px 0;
    flex-wrap: wrap;
    gap: 10px;
}
.left-section {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.right-section {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
#hubFilter, #exportBtn {
    padding: 5px 10px;
}

/* Green Export button */
#exportBtn {
    padding: 5px 10px;
    background-color: #4CAF50; /* Green background */
    color: white; /* White text */
    border-radius: 5px;
    border: none;
    cursor: pointer;
}

#exportBtn:hover {
    opacity: 0.9; /* Slightly reduce opacity on hover */
}

/* Requests table */
.table-container {
    overflow-x: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    min-width: 700px;
}
th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
}
th {
    background-color: #f2f2f2;
}
.status-pending {
    background-color: orange;
    color: white;
    padding: 5px 10px;
    border: none;
    cursor: pointer;
}
.status-completed {
    background-color: green;
    color: white;
    padding: 5px 10px;
    border: none;
}

/* Footer */
footer {
    text-align: center;
    position: fixed;
    bottom: 0;
    width: 100%;
    background-color: #f2f2f2;
    padding: 10px;
}

/* Responsive adjustments */
@media(max-width:900px){
    #dashboardPage .header img.logo-left,
    #dashboardPage .header img.logo-right {
        height: 50px;
    }
    #dashboardPage .header .title {
        font-size: 24px;
    }
}
@media(max-width:700px){
    .top-bar {
        flex-direction: column;
        align-items: flex-start;
    }
    .right-section {
        margin-top: 10px;
        width: 100%;
        justify-content: flex-start;
    }
    #hubFilter { min-width: 150px; }
}
@media(max-width:500px){
    #dashboardPage .header img.logo-left,
    #dashboardPage .header img.logo-right {
        position: static;
        transform: none;
        display: block;
        margin: 0 auto;
    }
    #dashboardPage .header .title {
        display: block;
        margin-top: 10px;
    }
    table { min-width: 600px; }
}

/* Login page headings */
.container h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #4CAF50;
}

/* Input focus effect */
input:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 5px rgba(76,175,80,0.5);
}
</style>
</head>
<body>

<!-- Manager Login -->
<div id="loginPage" class="container">
    <h2>Manager Login</h2>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button id="loginBtn" onclick="login()">Login</button>
    <div class="error" id="errorMessage"></div>
</div>

<!-- Manager Dashboard -->
<div id="dashboardPage" style="display:none;">
    <div class="header">
        <img src="logo1.png" class="logo-left" alt="Logo 1">
        <span class="title">Production Supervisor Access</span>
        <img src="logo2.png" class="logo-right" alt="Logo 2">
    </div>

    <div class="top-bar">
        <div class="left-section">
            <div id="managerName"></div>
            <button id="logoutBtn" onclick="logout()">Logout</button>
        </div>
        <div class="right-section">
            <label for="hubFilter">Filter by HUB:</label>
            <select id="hubFilter" onchange="loadManagerTable()">
                <option value="">All HUBs</option>
                <option>Hub 1</option><option>Hub 2</option><option>Hub 3</option>
                <option>Hub 4</option><option>Hub 5</option><option>Hub 6</option>
                <option>Hub 7</option><option>Hub 8</option><option>Events</option><option>SAS</option>
            </select>
            <button id="exportBtn" onclick="exportToExcel()">Export</button>
        </div>
    </div>

    <div class="table-container">
        <table id="requestsTable">
            <thead>
                <tr>
                    <th>Date</th><th>Name</th><th>Corp</th><th>HUB</th>
                    <th>Unit</th><th>Shift</th><th>Trip Number</th>
                    <th>Hours</th><th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
// Superuser and Manager accounts
const defaultManagers = [
    { username: "jcamins", password: "HMCAS1234", displayName: "James Camins CN 45357" },
    { username: "hkerkeni", password: "HMCAS1234", displayName: "Habib Ben Mohamed Hedi Kerkeni CN 11748" }
];

// Save managers in localStorage
let storedManagers = JSON.parse(localStorage.getItem('managerAccounts')) || [];
defaultManagers.forEach(def => {
    if(!storedManagers.find(m => m.username===def.username)) storedManagers.push(def);
});
localStorage.setItem('managerAccounts', JSON.stringify(storedManagers));

// Auto logout timer
let logoutTimer;
function resetTimer(){
    clearTimeout(logoutTimer);
    logoutTimer=setTimeout(()=>{
        alert("Logged out due to inactivity.");
        logout();
    },5*60*1000);
}
document.onmousemove = resetTimer;
document.onkeydown = resetTimer;

// Check login
function checkLogin(){
    const currentManager = JSON.parse(localStorage.getItem('currentManager'));
    if(currentManager){
        document.getElementById('loginPage').style.display='none';
        document.getElementById('dashboardPage').style.display='block';
        document.getElementById('managerName').innerText = currentManager.displayName;
        resetTimer();
        loadManagerTable();
    } else {
        document.getElementById('loginPage').style.display='block';
        document.getElementById('dashboardPage').style.display='none';
        document.getElementById('password').value='';
    }
}

// Login function
function login(){
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const managers = JSON.parse(localStorage.getItem('managerAccounts')) || [];
    const manager = managers.find(m=>m.username===username && m.password===password);
    if(manager){
        localStorage.setItem('currentManager', JSON.stringify(manager));
        checkLogin();
    } else {
        document.getElementById('errorMessage').innerText="Invalid username or password!";
        document.getElementById('password').value='';
    }
}

// Logout
function logout(){
    localStorage.removeItem('currentManager');
    document.getElementById('username').value='';
    document.getElementById('password').value='';
    checkLogin();
}

// Load table
function loadManagerTable(){
    const currentManager = JSON.parse(localStorage.getItem('currentManager'));
    if(!currentManager) return;
    const tbody = document.getElementById('requestsTable').querySelector('tbody');
    tbody.innerHTML='';
    const hubFilter = document.getElementById('hubFilter').value;
    let submissions = JSON.parse(localStorage.getItem('lateCallSubmissions')) || [];

    // Function to format the date
    function formatDate(dateString) {
        const date = new Date(dateString);
        const options = { day: '2-digit', month: 'short', year: 'numeric' };
        return date.toLocaleDateString('en-GB', options).replace(',', '').replace('.', '');
    }

    submissions.forEach((sub, index) => {
        if(hubFilter && sub.hub !== hubFilter) return;
        let statusButton = '';
        if(sub.status === "Pending"){
            statusButton = `<button class="status-pending" onclick="markCompleted(${index})">Pending</button>`;
        } else {
            const completedAt = sub.completedAt ? ` (${formatDate(sub.completedAt)})` : '';
            statusButton = `<span class="status-completed">Completed by ${sub.processedBy}${completedAt}</span>`;
        }
        
        // Format the date for submission date
        const formattedDate = formatDate(sub.date);
        
        tbody.innerHTML += `
            <tr>
                <td>${formattedDate}</td><td>${sub.name}</td><td>${sub.corp}</td><td>${sub.hub}</td>
                <td>${sub.unit}</td><td>${sub.shift}</td><td>${sub.trip}</td>
                <td>${sub.hours}</td><td>${statusButton}</td>
            </tr>
        `;
    });
}

// Mark completed
function markCompleted(index){
    let submissions = JSON.parse(localStorage.getItem('lateCallSubmissions')) || [];
    submissions[index].status="Completed";
    submissions[index].processedBy = JSON.parse(localStorage.getItem('currentManager')).displayName;
    submissions[index].completedAt = new Date().toLocaleString();
    localStorage.setItem('lateCallSubmissions', JSON.stringify(submissions));
    loadManagerTable();
}

// Export
function exportToExcel(){
    let submissions = JSON.parse(localStorage.getItem('lateCallSubmissions')) || [];
    const hubFilter = document.getElementById('hubFilter').value;
    if(hubFilter) submissions=submissions.filter(s=>s.hub===hubFilter);
    if(submissions.length===0){ alert("No data to export!"); return; }
    let csv="Date,Name,Corp,HUB,Unit,Shift,Trip Number,Hours,Status,Processed By,Completed At\n";
    submissions.forEach(sub=>{
        csv+=`${sub.date},${sub.name},${sub.corp},${sub.hub},${sub.unit},${sub.shift},${sub.trip},${sub.hours},${sub.status},${sub.processedBy||""},${sub.completedAt||""}\n`;
    });
    const blob=new Blob([csv],{type:'text/csv'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download="LateCallRequests.csv";
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Initialize
checkLogin();
</script>

<footer>
    Â© 2026 HMCAS Support Service Production. <br>
    James Ross Camins. All Rights Reserved.
</footer>

</body>
</html>
